{% extends "shop/base_shop.html" %}
{% load static %}
{% block shop_content %}

<h2 class="text-light mb-4">
    <i class="fa-solid fa-box-open text-warning"></i>
    Order #{{ order.id }}
</h2>

<div class="cozy-dark-glass p-4 rounded-3 text-light">

    {% with normal_status=order.status|upper normal_method=order.payment_method|lower %}

    <!-- ORDER INFO -->
    <p><strong>Status:</strong>
        {% if normal_method == "payroll" %}
            <span class="badge bg-warning text-dark">PAYROLL DEDUCTION</span>
        {% else %}
            <span class="badge bg-info text-dark">{{ order.get_status_display }}</span>
        {% endif %}
    </p>

    <p><strong>Date:</strong> {{ order.created_at|date:"j M Y, H:i" }}</p>
    <p><strong>Payment Method:</strong> {{ order.get_payment_method_display }}</p>

    <hr>

    <!-- ITEMS -->
    <h4 class="text-warning mb-3">Items</h4>

    {% for item in order.items.all %}
    <div class="d-flex justify-content-between border-bottom py-2">
        <div>{{ item.product.title }} (x{{ item.quantity }})</div>
        <div>£{{ item.line_total }}</div>
    </div>
    {% endfor %}

    <hr>

    <h4 class="text-warning">Total: £{{ order.total_amount }}</h4>

    <hr>

    <!-- BUTTONS -->
    <div class="mt-3 d-flex flex-wrap gap-2">

        <!-- PAYROLL ORDERS -->
        {% if normal_method == "payroll" %}

            <!-- PDF BUTTON -->
            <a href="{% url 'payroll_pdf' order.id %}"
               class="btn btn-warning text-dark">
               <i class="fa-solid fa-file-pdf me-2 text-dark"></i>
               Download Payroll Deduction PDF
            </a>

            <!-- COMPLETE PAYROLL -->
            {% if normal_status != "COMPLETED" %}
            <a href="{% url 'order_mark_payroll_complete' order.id %}"
               class="btn btn-success">
               <i class="fa-solid fa-check-circle me-2"></i>
               Mark Payroll as Completed
            </a>
            {% endif %}

        {% else %}

            <!-- CARD ORDER BUTTONS -->

            {% if normal_status == "PAID" %}
            <a href="{% url 'order_mark_dispatched' order.id %}"
               class="btn btn-info text-dark">
               <i class="fa-solid fa-paper-plane me-2"></i>
               Mark as Sent
            </a>
            {% endif %}

            {% if normal_status == "DISPATCHED" %}
            <a href="{% url 'order_mark_collected' order.id %}"
               class="btn btn-success">
               <i class="fa-solid fa-check me-2"></i>
               Mark as Collected
            </a>
            {% endif %}

        {% endif %}

    </div>

    {% endwith %}
</div>

{% endblock %}
